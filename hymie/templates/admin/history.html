{%- extends "/admin/base.html" %}

{% import "bootstrap/wtf.html" as wtf %}

{% block inner_content %}
    {{ super() }}
<main role="main">
   <div class="album py-5 bg-light">
        <div class="container">
            <div class="row">
                <div class="container alert alert-info">
                    <p><b>Usuario: </b>
                        {% if friendly_user_id %} {{ friendly_user_id }} ({% endif %}
                        <a href="mailto:{{ user_email }}" class="alert-link">{{ user_email }}</a>
                    {% if friendly_user_id %} ) {% endif %}
                    </p>
                </div>
            </div>
            <div class="row">
                <div class="container alert border border-primary rounded ">
                    <p><b>estado:</b>
                    <span class="dottedUnderline hymie-state" type=data-toggle="tooltip" data-placement="auto" title="">{{ state }}</span>
                    </p>
                    <p><b>desde:</b> {{ timestamp }}</p>
                    {% if action_zone and admin_links %}
                    <div class="row">
                        <div class="container text-center">
                                {% for link in admin_links %}
                                    <a role="button" class="btn hymie-button-{{ link.type }}" href="{{ view_link_for(link.endpoint) }}"  data-toggle="tooltip" data-placement="top" title="{{link.tooltip}}">{{ link.text }}</a>
                                {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            <hr>
<table id="example" class="display" style="width:100%">
        <thead>
            <tr>
                <th>Dia y hora</th>
                <th>Estado</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tfoot>
            <tr>
                <th>Dia y hora</th>
                <th>Formulario</th>
                <th>Acciones</th>
            </tr>
        </tfoot>
    </table>
        </div>
   </div>
</main>
{% endblock %}


{% block styles -%}
    {{super()}}
    <link rel="stylesheet" type="text/css"
          href="{{url_for('static', filename='jquery.dataTables.min.css')}}">
    <link rel="stylesheet" type="text/css"
          href="{{url_for('static', filename='buttons.dataTables.min.css')}}">
{% endblock %}

{% block scripts %}
{{super()}}

<script src="{{url_for('static', filename='jquery.dataTables.min.js')}}"></script>
<script src="{{url_for('static', filename='dataTables.bootstrap4.min.js')}}"></script>
<script src="{{url_for('static', filename='dataTables.buttons.min.js')}}"></script>
<script src="{{url_for('static', filename='buttons.html5.min.js')}}"></script>

<script language="JavaScript">
$(document).ready(function() {
    var desc = (function () {
        var json = null;
        $.ajax({
            'async': false,
            'global': false,
            'url': "/endpoint_descriptions",
            'dataType': "json",
            'success': function (data) {
                json = data;
            }
        });
        return json;
    })();
    $('#example').DataTable( {
        "ajax": '/admin/history_data/{{ uid }}', // state, timestamp + ' (+%d dias)'
        "columnDefs": [
            { "targets": 1,
              "render": function(data, type, row, meta){
                return '<span class="dottedUnderline" type=data-toggle="tooltip" data-placement="auto" title="'+ (desc[data] || 'Sin descripciÃ³n')  + '">'+ data + '</span>';
             }
            },
            { "targets": -1,
              "render": function(data, type, row, meta){
                return '<a href="/admin/history/{{uid}}/' + data[0] + '/' + data[1] + '">ver</a>';
             },
            },
        ],
        dom: 'Bfrtip',
        "buttons": [
            'pageLength', 'copy', 'csv',
        ]
    } );
    $(function () {
        $('.hymie-state').each(function(index) {
            $(this).attr("title", desc[$(this).html()])
            });
        $('[data-toggle="tooltip"]').tooltip();
        $(".hymie-button-accept").addClass("btn-success");
        $(".hymie-button-reject").addClass("btn-danger");
        $(".hymie-button-info").addClass("btn-info");
    })
} );
</script>

{% endblock %}

